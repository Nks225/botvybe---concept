# Техническое задание на разработку Telegram Mini App VYBE.TG

## Введение
Настоящее техническое задание описывает требования к разработке Telegram Mini App `VYBE.TG` для знакомств и общения пользователей внутри экосистемы Telegram.

Документ определяет:
- бизнес-цели и назначение системы;
- целевую аудиторию;
- структуру интерфейсов и ключевые сценарии;
- требования к дизайну;
- технические требования к архитектуре, данным, интеграциям и безопасности.

## Общие сведения
- Тип продукта: Telegram Mini App.
- Формат доступа: запуск через Telegram-бота (WebApp).
- Платформы: мобильные устройства (приоритет), поддержка desktop Telegram.
- Языки интерфейса: русский, английский.
- Основной пользовательский сценарий: создание анкеты, просмотр ленты, лайки/комментарии, взаимные лайки, переход в личное общение через Telegram.

## Назначение системы
Система предназначена для:
- быстрого знакомства пользователей без отдельной регистрации (через Telegram);
- формирования персонализированной ленты анкет;
- обмена реакциями (лайк, комментарий, ответ на комментарий);
- повышения качества совпадений через дополнительные сигналы интересов (мини-опрос);
- безопасной модерации контента и управления нарушениями.

Ключевые бизнес-результаты:
- сокращение времени до первого действия пользователя;
- рост вовлеченности за счет realtime-обновлений и простых свайп-сценариев;
- контроль качества аудитории и контента через жалобы, автоматические ограничения и админ-панель.

## Основные конкурентные преимущества компании
- Вход без отдельной регистрации: пользователь запускает приложение сразу в Telegram.
- Нативный мобильный UX: интерфейс и сценарии ориентированы на свайпы и короткие действия.
- Встроенная приватность: поддержка анонимного режима.
- Модерация в продукте: жалобы, автоматические ограничения и ручная админ-модерация.
- Realtime-модель: события обновляются без перезагрузки через серверные события.
- Механика удержания: лимиты лайков, реферальные бонусы и мини-опрос интересов.

## Целевая аудитория
- Пользователи Telegram 14+ (минимальный возраст по продуктовым правилам).
- Люди, заинтересованные в быстрых знакомствах с географической близостью.
- Пользователи, предпочитающие быстрый мобильный формат выбора (свайпы) и минимальный порог входа.

Сегменты:
- Основной: 18–34, активные пользователи мессенджеров и mini apps.
- Дополнительный: 35+, использующие Telegram как основной коммуникационный канал.

## Структура сайта
Приложение проектируется как одностраничный Telegram Mini App с нижней навигацией:
- `Профиль`
- `Лента`
- `Сообщения`

Дополнительные модальные и служебные экраны:
- создание/редактирование анкеты;
- отправка комментария;
- просмотр анкеты из входящего лайка;
- настройки;
- пользовательское соглашение;
- панель администратора;
- экран блокировки (бан);
- экран восстановления удаленного аккаунта.

## Описание экранов

### Главная
Главным экраном приложения считается раздел `Профиль` (первая точка взаимодействия после авторизации).

Содержимое:
- данные пользователя Telegram (аватар, имя, username, id);
- статус лайков и время до восстановления лимита;
- управление никнеймом;
- кнопка создания/редактирования анкеты;
- переключатель анонимного режима;
- переключатели темы и языка;
- доступ к настройкам;
- доступ к админ-панели (для роли администратора).

### Лента
- Карточка анкеты с фото, именем/ником, возрастом, городом, описанием.
- Действия: лайк, комментарий, пропуск.
- Управление фильтрами по полу.
- Режим свайпов.
- Блок жалобы на анкету.
- Состояния: нет анкет в системе / нет анкет по фильтру.

### Сообщения
- Единый список входящих событий: комментарии, лайки, взаимные лайки, ответы.
- Действия: удалить, ответить на комментарий, открыть анкету, ответить на лайк.
- Группировка повторных лайков от одного пользователя.
- Переход в Telegram-чат при взаимном лайке.

### Модальные экраны
- Анкета: ввод города, возраста, пола, видимости в фильтре, описания, загрузка до 3 фото.
- Комментарий: ввод текста до 256 символов.
- Просмотр анкеты из лайка: фото, данные, действия «ответный лайк/пропуск».
- Настройки: уведомления, информация о продукте, удаление аккаунта.
- Условия использования: обязательное подтверждение перед полноценным доступом.
- Админ-панель: пользователи, жалобы, бан/разбан/удаление.

## Прототип
Требуется разработать интерактивный прототип mobile-first (Figma) со следующими пользовательскими потоками:
- `Onboarding`: запуск WebApp → авторизация → принятие условий.
- `Profile setup`: создание анкеты с фото и сохранение.
- `Feed actions`: просмотр ленты → лайк/комментарий/пропуск → переход к следующей анкете.
- `Messaging`: открытие входящих → ответ/удаление/просмотр анкеты.
- `Like response`: входящий лайк → просмотр анкеты → ответный лайк/пропуск.
- `Moderation`: отправка жалобы → обработка в админ-панели.
- `Account lifecycle`: удаление аккаунта → восстановление в течение 24 часов.

## Описание
Функциональные требования:

1. Авторизация и доступ
- Вход через Telegram `initData`.
- Проверка подписи `initData` в production.
- Блокировка доступа для забаненных пользователей.
- Блокировка ключевого функционала до принятия пользовательского соглашения.

2. Анкеты
- Обязательные поля: город, возраст, пол, минимум 1 фото.
- Допустимый возраст: 14–99.
- Фото: до 3 файлов, проверка пропорций, конвертация в `webp`, проверка NSFW.
- Возможность обновлять анкету и удалять анкету.

3. Лента
- Подбор анкет по городу и возрастному коридору `±2 года`.
- Исключение собственной анкеты из выдачи.
- Учет фильтра пола и настроек видимости анкеты.
- Поддержка свайп-навигации и кнопочных действий.

4. Лайки и лимиты
- Базовый лимит лайков на пользователя.
- Автовосстановление лимита по таймеру.
- Реферальная механика с бонусом лайков.
- Уведомления получателю лайка в приложении и через Telegram-бота (если офлайн).

5. Комментарии и ответы
- Комментарий к анкете до 256 символов.
- Ответ владельца анкеты на комментарий (однократно).
- Показ входящих/исходящих сообщений в едином списке.

6. Мини-опрос
- Показ карточки мини-опроса в ленте по логике ротации.
- Сохранение ответа с TTL.
- Сопоставление одинакового варианта интереса у пары при обработке лайка.

7. Жалобы и модерация
- Отправка жалобы на анкету с причиной.
- Ограничение частоты повторных жалоб от одного пользователя.
- Автоматический временный бан при превышении порога жалоб.
- Админ-панель для ручной обработки жалоб и управления пользователями.

8. Аккаунт
- Мягкое удаление аккаунта пользователем.
- Окно восстановления в течение 24 часов.
- Принудительный выход пользователя при бане или удалении.

9. Realtime
- Поддержка server-sent events (SSE) для:
- новых сообщений;
- лайков и обновления счетчиков;
- обновления анкет в ленте;
- системных событий (например, force logout).

## Требования к дизайну
- Формат: mobile-first, приоритет портретной ориентации.
- Поддержка safe-area (вырезы/нижние панели устройств).
- UI должен быть единообразным на всех основных экранах и модалках.
- Поддержка двух тем: `light` и `dark`.
- Поддержка локализации: `ru` / `en`.
- Основные UX-принципы:
- минимальное количество шагов до целевого действия;
- крупные зоны нажатия;
- четкие состояния загрузки, ошибок и пустых экранов;
- подтверждения для критичных действий (удаление профиля/аккаунта).
- Для фото в ленте и профиле обязательны:
- сохранение пропорций отображения;
- визуально стабильная карусель;
- предсказуемое свайп-поведение.

## Технические требования

1. Архитектура
- Frontend: `React + TypeScript + Vite + styled-components`.
- Backend: `Node.js + Express`.
- База данных: `PostgreSQL`.
- ORM: `Prisma`.
- Медиа-обработка: `sharp`.
- Загрузка файлов: `multer`.
- Инфраструктура: `Docker Compose` (frontend, backend, db).

2. Интеграции
- Telegram WebApp API:
- авторизация по `initData`;
- открытие Telegram-ссылок/чатов;
- управление поведением webview.
- Telegram Bot API:
- отправка уведомлений о событиях.

3. Данные и хранение
- Ключевые сущности: `User`, `Profile`, `Anketa`, `Photo`, `Like`, `LikeEvent`, `Comment`, `Complaint`, `MiniPollAnswer`.
- Фото хранятся в файловом хранилище сервера, метаданные в БД.
- Для сообщений/уведомлений используется модель событий на основе `LikeEvent` и `Comment`.

4. API
- REST API с обязательной идентификацией пользователя через Telegram.
- Группы методов:
- авторизация и профиль;
- анкеты и лента;
- лайки и сообщения;
- жалобы;
- настройки;
- администрирование;
- realtime endpoint для SSE-подписки.

5. Нефункциональные требования
- Безопасность:
- в production обязательна проверка подписи Telegram `initData`;
- валидация входных данных на backend;
- ограничение длины пользовательских полей;
- ограничения на тип/размер/количество фото.
- Производительность:
- сервер должен поддерживать одновременные SSE-подключения;
- обработка изображений должна выполняться асинхронно.
- Надежность:
- корректная очистка временных файлов;
- устойчивость к обрывам realtime-соединений с автоматическим переподключением на клиенте.

6. Ограничения и бизнес-правила
- Обязательное принятие пользовательского соглашения.
- Лимиты на лайки и сообщения в соответствии с продуктовой логикой.
- Блокировка пользователей по правилам модерации.
- Удаленные аккаунты недоступны в выдаче.

7. Критерии приемки
- Пользователь может пройти путь: вход → создание анкеты → просмотр ленты → отправка лайка/комментария.
- Получатель видит входящие события без перезагрузки приложения.
- Жалоба доступна в интерфейсе и обрабатывается в админ-панели.
- Бан/удаление аккаунта немедленно ограничивает доступ.
- Локализация, тема и адаптивность работают на целевых устройствах.
